<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Starborn Transmission</title>
<style>
  body, html {
    margin: 0; padding: 0; width: 100%; height: 100%;
    overflow: hidden; background-color: #000;
    font-family: system-ui, -apple-system, "Courier New", Courier, monospace, "Microsoft JhengHei";
    user-select: none; -webkit-tap-highlight-color: transparent;
  }
  canvas { display: block; }

  /* æƒæç·šæ¿¾é¡æ„Ÿ */
  body::after {
    content: " "; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
    background-size: 100% 4px; pointer-events: none; z-index: 500;
  }

  /* å•Ÿå‹•ä»‹é¢ */
  #boot-screen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #000; z-index: 2000; display: flex; flex-direction: column;
    align-items: center; justify-content: center; color: #00ff41;
    transition: opacity 0.8s ease;
  }
  
  /* çµæŸä»‹é¢ */
  #end-screen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #000; z-index: 2000; display: none; flex-direction: column;
    align-items: center; justify-content: center; color: #00ff41;
    opacity: 0; transition: opacity 2s ease;
  }

  .term-line { font-size: 14px; margin: 5px; letter-spacing: 2px; text-align: center; }
  #countdown-timer { font-size: 28px; color: #ff3333; margin: 20px 0; text-shadow: 0 0 15px rgba(255,51,51,0.5); font-weight: 900; }

  #start-btn {
    margin-top: 20px; padding: 15px 40px; border: 1px solid #444;
    background: rgba(255, 255, 255, 0.05); color: #444; cursor: not-allowed;
    font-family: inherit; font-weight: bold; letter-spacing: 4px; transition: all 0.5s;
  }
  #start-btn.unlocked {
    border-color: #00ff41; color: #00ff41; cursor: pointer;
    box-shadow: 0 0 15px rgba(0, 255, 65, 0.2); background: rgba(0, 255, 65, 0.1);
  }

  /* æˆ°è¡“ HUD */
  #hud {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 100; display: none; color: #00ff41;
  }
  .reticle { position: absolute; border: 1px solid rgba(0, 255, 65, 0.3); width: 50px; height: 50px; }
  .tl { top: 20px; left: 20px; border-right: none; border-bottom: none; }
  .tr { top: 20px; right: 20px; border-left: none; border-bottom: none; }
  .bl { bottom: 20px; left: 20px; border-right: none; border-top: none; }
  .br { bottom: 20px; right: 20px; border-left: none; border-top: none; }
  #data-stream { position: absolute; top: 40px; left: 80px; font-size: 10px; line-height: 1.8; }
  #charge-ui { position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%); width: 200px; height: 4px; border: 1px solid #00ff41; display: none; }
  #charge-bar { width: 0%; height: 100%; background: #00ff41; }
</style>
</head>
<body>

<div id="boot-screen">
  <div class="term-line">UPLINKING TO MASTER_CHEN_TERMINAL...</div>
  <div id="status-line" class="term-line">STATUS: LAUNCH_WINDOW_PENDING</div>
  <div id="countdown-timer">00:00:00</div>
  <div class="term-line" style="color: #ffd700; margin-top: 10px;">> è·¨å¹´é€šè¨Šä»»å‹™ï¼šç­‰å¾…è¡›æ˜Ÿçª—å£é–‹å•Ÿ</div>
  <button id="start-btn" disabled>æ¥æ”¶é©šå–œç¥ç¦</button>
</div>

<div id="end-screen">
  <div class="term-line" style="font-size: 20px; color: #ffd700;">MISSION COMPLETE</div>
  <div class="term-line" style="margin-top: 20px;">é ç«¯é€£ç·šå·²ä¸­æ–·...</div>
  <div class="term-line" style="color: #666;">é©šå–œå·²çµæŸ</div>
</div>

<div id="hud">
  <div class="reticle tl"></div><div class="reticle tr"></div>
  <div class="reticle bl"></div><div class="reticle br"></div>
  <div id="data-stream">
    SIGNAL: STABLE<br>
    UNIT: DRONE_SQUAD_2026<br>
    CMD: LONG_PRESS_TO_CHARGE<br>
    DBL_TAP: SKIP_PATTERN
  </div>
  <div id="charge-ui"><div id="charge-bar"></div></div>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const tCanvas = document.createElement("canvas");
const tCtx = tCanvas.getContext("2d");

let width, height, dpr;
let drones = [], fireworks = [], fwParticles = [];
let isStarted = false, isEnded = false, currentIdx = 0;
let mouse = { x: -1000, y: -1000, active: false, charge: 0 };
let lastTap = 0;

const targetTime = new Date("2026/01/01 00:00:00").getTime();

const patterns = [
  { text: "å®£è¾°å°‘çˆº", color: "#FFD700" },
  { text: "READY?", color: "#00FF95" },
  { text: "3", color: "#00FF95" },
  { text: "2", color: "#00FF95" },
  { text: "1", color: "#00FF95" },
  { text: "2026\nHAPPY NEW YEAR", color: "#00E5FF" },
  { text: "é€€ä¼å€’æ•¸", color: "#FFA500" },
  { text: "å…‰æ¦®æ­¸ä¾†", color: "#FF6EB4" },
  { text: "ğŸ–ï¸", color: "#FFD700" }
];

function updateCountdown() {
    const now = new Date().getTime();
    const diff = targetTime - now;
    if (diff <= 0) {
        document.getElementById("countdown-timer").innerText = "00:00:00";
        document.getElementById("countdown-timer").style.color = "#00ff41";
        document.getElementById("countdown-timer").style.textShadow = "0 0 10px #00ff41";
        document.getElementById("status-line").innerText = "STATUS: ACCESS_GRANTED";
        const btn = document.getElementById("start-btn");
        btn.disabled = false;
        btn.classList.add("unlocked");
        return;
    }
    const h = Math.floor((diff % 86400000) / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);
    document.getElementById("countdown-timer").innerText = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    requestAnimationFrame(updateCountdown);
}
updateCountdown();

function init() {
  // --- æ ¸å¿ƒä¿®å¾©ï¼šè§£æ±ºæ‰‹æ©Ÿæ¨¡ç³Šå•é¡Œ ---
  dpr = window.devicePixelRatio || 1;
  width = window.innerWidth;
  height = window.innerHeight;
  
  // è¨­å®šä¸»ç•«å¸ƒç‰©ç†åƒç´ 
  canvas.width = width * dpr;
  canvas.height = height * dpr;
  canvas.style.width = width + 'px';
  canvas.style.height = height + 'px';
  ctx.scale(dpr, dpr);

  // è¨­å®šé›¢å±ç•«å¸ƒç‰©ç†åƒç´  (ç¢ºä¿æ¡æ¨£é»é«˜æ¸…)
  tCanvas.width = width * dpr;
  tCanvas.height = height * dpr;
  tCtx.scale(dpr, dpr);
  
  if (drones.length === 0) {
    for (let i = 0; i < 2800; i++) drones.push(new Drone());
  }
}

class Drone {
  constructor() {
    this.x = Math.random() * window.innerWidth;
    this.y = Math.random() * window.innerHeight;
    this.targetX = this.x; this.targetY = this.y;
    this.vx = 0; this.vy = 0;
    this.color = '#fff';
    this.size = 1.6;
    this.easing = 0.05 + Math.random() * 0.03;
    this.noise = Math.random() * 100;
  }
  update() {
    let dx = this.targetX - this.x;
    let dy = this.targetY - this.y;
    this.vx += dx * 0.012;
    this.vy += dy * 0.012;
    if (mouse.active && !isEnded) {
      let mdx = mouse.x - this.x;
      let mdy = mouse.y - this.y;
      let dist = Math.sqrt(mdx*mdx + mdy*mdy);
      if (mouse.charge > 5) {
        this.vx += mdx * 0.04; this.vy += mdy * 0.04;
      } else if (dist < 100) {
        this.vx -= mdx * 0.2; this.vy -= mdy * 0.2;
      }
    }
    this.vx *= 0.85; this.vy *= 0.85;
    this.x += this.vx; this.y += this.vy;
  }
  draw() {
    // ä½¿ç”¨ Math.floor é˜²æ­¢æ¬¡åƒç´ æ¨¡ç³Š
    const px = Math.floor(this.x);
    const py = Math.floor(this.y);
    ctx.fillStyle = this.color;
    ctx.shadowBlur = 4;
    ctx.shadowColor = this.color;
    ctx.fillRect(px, py, this.size, this.size);
    ctx.shadowBlur = 0;
  }
}

function loadPattern(obj) {
  tCtx.clearRect(0, 0, width, height);
  const lines = obj.text.split('\n');
  let fontSize = (obj.text.length > 4) ? 160 : 240;
  if (obj.text.length > 12) fontSize = 110;

  // ä½¿ç”¨ç³»çµ±å­—é«”ä¸¦å¼·åˆ¶æ¥µç²—é«”
  tCtx.font = `900 ${fontSize}px system-ui, -apple-system, "Microsoft JhengHei", sans-serif`;
  tCtx.textAlign = "left"; tCtx.textBaseline = "top"; 
  tCtx.fillStyle = "white";

  const lineHeight = fontSize * 1.2;
  lines.forEach((line, index) => {
    tCtx.fillText(line, 50, 50 + (index * lineHeight));
  });

  // æ ¹æ“šç‰©ç†åƒç´ æ¡æ¨£
  const imgData = tCtx.getImageData(0, 0, width * dpr, height * dpr).data;
  const pixels = [];
  let minX = 9999, maxX = 0, minY = 9999, maxY = 0;

  // ç¸®å°æ¡æ¨£é–“è· (Gap 6)ï¼Œè®“å­—é«”æ›´ç´°è†©
  const gap = Math.floor(6 * dpr); 
  for (let y = 0; y < height * dpr; y += gap) {
    for (let x = 0; x < width * dpr; x += gap) {
      if (imgData[(y * (width * dpr) + x) * 4 + 3] > 128) {
        const lx = x / dpr;
        const ly = y / dpr;
        pixels.push({ x: lx, y: ly });
        if (lx < minX) minX = lx; if (lx > maxX) maxX = lx;
        if (ly < minY) minY = ly; if (ly > maxY) maxY = ly;
      }
    }
  }

  const textCenterX = (minX + maxX) / 2;
  const textCenterY = (minY + maxY) / 2;
  const textWidth = maxX - minX;
  const textHeight = maxY - minY;
  const scale = Math.min((width * 0.85) / textWidth, (height * 0.45) / textHeight, 1.5);

  drones.forEach((d, i) => {
    const p = pixels[i % pixels.length];
    d.targetX = (p.x - textCenterX) * scale + (width / 2);
    d.targetY = (p.y - textCenterY) * scale + (height / 2);
    d.color = obj.color;
    d.vx += (Math.random()-0.5)*15; d.vy += (Math.random()-0.5)*15;
  });
}

function endShow() {
    isEnded = true;
    drones.forEach(d => {
        d.targetX = Math.random() * width;
        d.targetY = Math.random() * height;
        d.color = "rgba(255,255,255,0.1)";
    });
    const endScreen = document.getElementById("end-screen");
    endScreen.style.display = "flex";
    setTimeout(() => { endScreen.style.opacity = "1"; document.getElementById("hud").style.opacity = "0"; }, 100);
}

function nextStep() {
    if (isEnded) return;
    currentIdx++;
    if (currentIdx < patterns.length) {
        loadPattern(patterns[currentIdx]);
        let waitTime = 5000;
        const txt = patterns[currentIdx].text;
        if (["READY?", "3", "2", "1"].includes(txt)) waitTime = 1500;
        else if (txt.includes("HAPPY")) waitTime = 7000;
        setTimeout(nextStep, waitTime);
    } else {
        setTimeout(endShow, 5000);
    }
}

class Firework {
  constructor(tx, ty, hue) {
    this.x = tx || Math.random() * width;
    this.y = height;
    this.ty = ty || Math.random() * (height * 0.4);
    this.speed = 8;
    this.hue = hue || Math.random() * 360;
    this.dead = false;
  }
  update() {
    this.y -= this.speed;
    if (this.y <= this.ty) {
      this.dead = true;
      for(let i=0; i<50; i++) fwParticles.push(new FWParticle(this.x, this.y, this.hue));
    }
  }
  draw() {
    ctx.fillStyle = `hsl(${this.hue}, 100%, 70%)`;
    ctx.fillRect(Math.floor(this.x), Math.floor(this.y), 2, 10);
  }
}

class FWParticle {
  constructor(x, y, hue) {
    this.x = x; this.y = y; this.hue = hue;
    this.v = { x: (Math.random()-0.5)*12, y: (Math.random()-0.5)*12 };
    this.alpha = 1; this.decay = 0.02;
  }
  update() { this.x += this.v.x; this.y += this.v.y; this.v.y += 0.15; this.alpha -= this.decay; }
  draw() {
    ctx.globalAlpha = this.alpha;
    ctx.fillStyle = `hsl(${this.hue}, 100%, 70%)`;
    ctx.beginPath(); ctx.arc(Math.floor(this.x), Math.floor(this.y), 1.2, 0, Math.PI*2); ctx.fill();
    ctx.globalAlpha = 1;
  }
}

function animate() {
  ctx.globalCompositeOperation = 'source-over';
  ctx.fillStyle = "rgba(0, 0, 0, 0.25)";
  ctx.fillRect(0, 0, width, height);

  if (isStarted) {
    if (mouse.active && !isEnded) {
      mouse.charge = Math.min(mouse.charge + 1.5, 100);
      document.getElementById("charge-bar").style.width = mouse.charge + "%";
      document.getElementById("charge-ui").style.display = "block";
    }
    ctx.globalCompositeOperation = 'lighter';
    if (Math.random() < 0.03 && !isEnded) fireworks.push(new Firework());
    fireworks = fireworks.filter(f => { f.update(); f.draw(); return !f.dead; });
    fwParticles = fwParticles.filter(p => { p.update(); p.draw(); return p.alpha > 0; });
    ctx.globalCompositeOperation = 'source-over';
    drones.forEach(d => { d.update(); d.draw(); });
  }
  requestAnimationFrame(animate);
}

document.getElementById("start-btn").addEventListener("click", function() {
  if (this.disabled) return;
  document.getElementById("boot-screen").style.opacity = "0";
  setTimeout(() => {
    document.getElementById("boot-screen").style.display = "none";
    document.getElementById("hud").style.display = "block";
    isStarted = true;
    init(); loadPattern(patterns[currentIdx]); animate();
    setTimeout(nextStep, 5000);
  }, 800);
});

const handleDown = (e) => {
  if (!isStarted || isEnded) return;
  const now = Date.now();
  if (now - lastTap < 300) {
    currentIdx++;
    if (currentIdx < patterns.length) loadPattern(patterns[currentIdx]);
    else endShow();
    return;
  }
  lastTap = now;
  const p = e.touches ? e.touches[0] : e;
  mouse.x = p.clientX; mouse.y = p.clientY;
  mouse.active = true;
};

const handleUp = () => {
  if (mouse.charge > 50) {
    for(let i=0; i<6; i++) setTimeout(() => fireworks.push(new Firework(Math.random()*width, Math.random()*height*0.5)), i * 120);
  }
  mouse.active = false; mouse.charge = 0;
  document.getElementById("charge-ui").style.display = "none";
};

const handleMove = (e) => {
  const p = e.touches ? e.touches[0] : e;
  mouse.x = p.clientX; mouse.y = p.clientY;
};

window.addEventListener("mousedown", handleDown);
window.addEventListener("mouseup", handleUp);
window.addEventListener("mousemove", handleMove);
window.addEventListener("touchstart", handleDown);
window.addEventListener("touchend", handleUp);
window.addEventListener("touchmove", handleMove);

window.addEventListener("resize", () => {
  init();
  if(isStarted) loadPattern(patterns[currentIdx]);
});

init();
</script>
</body>
</html>
